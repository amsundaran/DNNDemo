(function(g){function d(){var i=document.createElement("input"),a="onpaste";return i.setAttribute(a,""),"function"==typeof i[a]?"paste":"input"}var j,b=d()+".mask",f=navigator.userAgent,c=/iphone/i.test(f),h=/android/i.test(f);g.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},g.fn.extend({caret:function(i,a){var k;if(0!==this.length&&!this.is(":hidden")){return"number"==typeof i?(a="number"==typeof a?a:i,this.each(function(){this.setSelectionRange?this.setSelectionRange(i,a):this.createTextRange&&(k=this.createTextRange(),k.collapse(!0),k.moveEnd("character",a),k.moveStart("character",i),k.select())})):(this[0].setSelectionRange?(i=this[0].selectionStart,a=this[0].selectionEnd):document.selection&&document.selection.createRange&&(k=document.selection.createRange(),i=0-k.duplicate().moveStart("character",-100000),a=i+k.text.length),{begin:i,end:a})}},unmask:function(){return this.trigger("unmask")},mask:function(i,n){var p,a,m,e,o,k;return !i&&this.length>0?(p=g(this[0]),p.data(g.mask.dataName)()):(n=g.extend({placeholder:g.mask.placeholder,completed:null},n),a=g.mask.definitions,m=[],e=k=i.length,o=null,g.each(i.split(""),function(q,l){"?"==l?(k--,e=q):a[l]?(m.push(RegExp(a[l])),null===o&&(o=m.length-1)):m.push(null)}),this.trigger("unmask").each(function(){function z(v){for(;k>++v&&!m[v];){}return v}function w(v){for(;--v>=0&&!m[v];){}return v}function q(y,x){var E,v;if(!(0>y)){for(E=y,v=z(x);k>E;E++){if(m[E]){if(!(k>v&&m[E].test(t[v]))){break}t[E]=t[v],t[v]=n.placeholder,v=z(v)}}B(),C.caret(Math.max(o,y))}}function l(E){var y,F,v,x;for(y=E,F=n.placeholder;k>y;y++){if(m[y]){if(v=z(y),x=t[y],t[y]=F,!(k>v&&m[v].test(x))){break}F=x}}}function u(E){var x,F,v,y=E.which;8===y||46===y||c&&127===y?(x=C.caret(),F=x.begin,v=x.end,0===v-F&&(F=46!==y?w(F):v=z(F-1),v=46===y?z(v):v),r(F,v),q(F,v-1),E.preventDefault()):27==y&&(C.val(s),C.caret(0,A()),E.preventDefault())}function D(F){var G,x,E,v=F.which,y=C.caret();F.ctrlKey||F.altKey||F.metaKey||32>v||v&&(0!==y.end-y.begin&&(r(y.begin,y.end),q(y.begin,y.end-1)),G=z(y.begin-1),k>G&&(x=String.fromCharCode(v),m[G].test(x)&&(l(G),t[G]=x,B(),E=z(G),h?setTimeout(g.proxy(g.fn.caret,C,E),0):C.caret(E),n.completed&&E>=k&&n.completed.call(C))),F.preventDefault())}function r(x,v){var y;for(y=x;v>y&&k>y;y++){m[y]&&(t[y]=n.placeholder)}}function B(){C.val(t.join(""))}function A(E){var y,F,v=C.val(),x=-1;for(y=0,pos=0;k>y;y++){if(m[y]){for(t[y]=n.placeholder;pos++<v.length;){if(F=v.charAt(pos-1),m[y].test(F)){t[y]=F,x=y;break}}if(pos>v.length){break}}else{t[y]===v.charAt(pos)&&y!==e&&(pos++,x=y)}}return E?B():e>x+1?(C.val(""),r(0,k)):(B(),C.val(C.val().substring(0,x+1))),e?y:o}var C=g(this),t=g.map(i.split(""),function(v){return"?"!=v?a[v]?n.placeholder:v:void 0}),s=C.val();C.data(g.mask.dataName,function(){return g.map(t,function(x,v){return m[v]&&x!=n.placeholder?x:null}).join("")}),C.attr("readonly")||C.one("unmask",function(){C.unbind(".mask").removeData(g.mask.dataName)}).bind("focus.mask",function(){clearTimeout(j);var v;s=C.val(),v=A(),j=setTimeout(function(){B(),v==i.length?C.caret(0,v):C.caret(v)},10)}).bind("blur.mask",function(){A(),C.val()!=s&&C.change()}).bind("keydown.mask",u).bind("keypress.mask",D).bind(b,function(){setTimeout(function(){var v=A(!0);C.caret(v),n.completed&&v==C.val().length&&n.completed.call(C)},0)}),A()}))}})})(dnnsfjQuery);(function(a){a.extend(a,{placeholder:{browser_supported:function(){return this._supported!==undefined?this._supported:(this._supported=!!("placeholder" in a('<input type="text">')[0]))},shim:function(c){var b={color:"#888",cls:"placeholder",selector:"input[placeholder], textarea[placeholder]"};a.extend(b,c);return !this.browser_supported()&&a(b.selector)._placeholder_shim(b)}}});a.extend(a.fn,{_placeholder_shim:function(d){function c(f){var g=a(f).offsetParent().offset();var e=a(f).offset();return{top:e.top-g.top,left:e.left-g.left,width:a(f).width()}}function b(f){var e=f.data("target");if(typeof e!=="undefined"){f.css(c(e));a(window).one("resize",function(){b(f)})}}return this.each(function(){var h=a(this);if(h.is(":visible")){if(h.data("placeholder")){var e=h.data("placeholder");e.css(c(h));return true}var g={};if(!h.is("textarea")&&h.css("height")!="auto"){g={lineHeight:h.css("height"),whiteSpace:"nowrap"}}var f=a("<label />").text(h.attr("placeholder")).addClass(d.cls).css(a.extend({position:"absolute",display:"inline","float":"none",overflow:"hidden",textAlign:"left",color:d.color,cursor:"text",paddingTop:h.css("padding-top"),paddingRight:h.css("padding-right"),paddingBottom:h.css("padding-bottom"),paddingLeft:h.css("padding-left"),fontSize:h.css("font-size"),fontFamily:h.css("font-family"),fontStyle:h.css("font-style"),fontWeight:h.css("font-weight"),textTransform:h.css("text-transform"),backgroundColor:"transparent",zIndex:99},g)).css(c(this)).attr("for",this.id).data("target",h).click(function(){a(this).data("target").focus()}).insertBefore(this);h.data("placeholder",f).focus(function(){f.hide()}).blur(function(){f[h.val().length?"hide":"show"]()}).triggerHandler("blur");a(window).one("resize",function(){b(f)})}})}})})(dnnsfjQuery);dnnsfjQuery(document).add(window).bind("ready load",function(){if(dnnsfjQuery.placeholder){dnnsfjQuery.placeholder.shim()}});
/*!
 * jQuery Cookie Plugin v1.4.0
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function(a){if(typeof define==="function"&&define.amd){define(["dnnsfjQuery"],a)}else{a(dnnsfjQuery)}}(function(f){var a=/\+/g;function d(i){return b.raw?i:encodeURIComponent(i)}function g(i){return b.raw?i:decodeURIComponent(i)}function h(i){return d(b.json?JSON.stringify(i):String(i))}function c(i){if(i.indexOf('"')===0){i=i.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{i=decodeURIComponent(i.replace(a," "));return b.json?JSON.parse(i):i}catch(j){}}function e(j,i){var k=b.raw?j:c(j);return f.isFunction(i)?i(k):k}var b=f.cookie=function(q,p,v){if(p!==undefined&&!f.isFunction(p)){v=f.extend({},b.defaults,v);if(typeof v.expires==="number"){var r=v.expires,u=v.expires=new Date();u.setDate(u.getDate()+r)}return(document.cookie=[d(q),"=",h(p),v.expires?"; expires="+v.expires.toUTCString():"",v.path?"; path="+v.path:"",v.domain?"; domain="+v.domain:"",v.secure?"; secure":""].join(""))}var w=q?undefined:{};var s=document.cookie?document.cookie.split("; "):[];for(var o=0,m=s.length;o<m;o++){var n=s[o].split("=");var j=g(n.shift());var k=n.join("=");if(q&&q===j){w=e(k,p);break}if(!q&&(k=e(k))!==undefined){w[j]=k}}return w};b.defaults={};f.removeCookie=function(j,i){if(f.cookie(j)===undefined){return false}f.cookie(j,"",f.extend({},i,{expires:-1}));return !f.cookie(j)}}));function ActionFormCtrl($scope,$http,$timeout,$sce,$cookieStore,dataSources,dnnsf){var $=dnnsfjQuery;$scope.dnnsf=dnnsf;$scope.$sce=$sce;$scope.Math=Math;$scope.testTags=[];$scope.form={fields:[]};$scope.init=function(data){$scope.load(data)};$scope.parse=function(val){if($.isNumeric(val)){return parseFloat(val)}val=val.toString().replace(/,(\d{3})/g,"$1");if($.isNumeric(val)){return parseFloat(val)}return val};$scope.load=function(data){if(data.error){alert("Error: "+data.error);return}$scope.form=data;$scope.$$=$;if(data.response){parseFormResponse2($("#"+data.baseId+"root"),undefined,data.response)}$.each($scope.form.fields,function(k,o){if(o.onChange){o.onChange=eval("( function(form, item) {    try {        var scope = angular.element('#"+data.baseId+"root').scope();        var refresh = function() { if (!scope.$$phase) scope.$apply(); };        var r = (function() { "+o.onChange+" }).call($('#"+o.id+"'));        $('#"+o.id+"')[0].preventSubmit = false;       if (o.actionCount == 0 || r === false) {            $('#"+o.id+"')[0].preventSubmit = true; return false;        }    } catch (e) { console.log('Error running Action Form on change script', e); }})")}if(o.options){o.ddValue=o.tbValue=o.value;for(var i=0;i<o.options.length;i++){if(o.options[i].value==o.value){o.selected=o.options[i];break}}var other=$.grep(o.options,function(oOpt,iOpt){return oOpt.filter=="other"});other=other.length?other[0]:null;if(other&&o.value&&$.grep(o.options,function(oOpt,iOpt){return oOpt.value==o.value}).length==0){o.ddValue=other.value}if(o.type=="closed-multiple-checkbox"||o.type=="dropdown-checkboxes"){$scope.concatValues(o);$scope.$watch("form.fields."+o.name+".value",function(){var selItems=o.value.split(",");$.each(o.options,function(k,oItem){oItem.selected=$.inArray(oItem.value,selItems)!=-1})});o.checkAll=function(){$.each(o.options,function(k,oItem){oItem.selected=true})};o.uncheckAll=function(){$.each(o.options,function(k,oItem){oItem.selected=false})}}else{$scope.$watch("form.fields."+o.name+".value",function(newValue,oldValue){var fnFilter=o.linkedTo?$scope.fnFactoryFilterByField(o.name,o.linkedTo):function(){return true};for(var i=0;i<o.options.length;i++){if(fnFilter(o.options[i])&&o.options[i].value==newValue){o.selected=o.options[i];break}}})}if(o.options.length){o.optionsFilters=[];$.each(o.options,function(ii,oo){if($.inArray(oo.filter,o.optionsFilters)==-1){o.optionsFilters.push(oo.filter)}});o.optionsNames=[];o.optionsByName={};$.each(o.options,function(ii,oo){if(!o.optionsByName[oo.text]){o.optionsNames.push(oo.text);o.optionsByName[oo.text]=[]}o.optionsByName[oo.text].push(oo)})}}});if($scope.form.onLoad){eval("( function(form) { try { "+$scope.form.onLoad+"; } catch (e) { console.log('Error running Action Form on load script', e); } } )").call($scope,$scope.form)}if($scope.form.SaveInCookie){var saveInCookiesTimer;function saveInCookies(){$timeout.cancel(saveInCookiesTimer);saveInCookiesTimer=$timeout(function(){var saveData={};$.each($scope.form.fields,function(k,o){if(o.hasValue){saveData[k]=o.value}});$http({method:"POST",url:$scope.form.submitUrl+"&event=autosave&submission="+($scope.form.submissionKey||""),headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(saveData)}).success(function(data,status){$cookieStore.put($scope.form.SaveInCookie,data.submissionKey,{path:"/",expires:365})})},500)}$scope.$watch("form.fields",saveInCookies,true)}};var _find=function(v,callback){var n=v.length;for(var i=0;i<n;i++){if(callback(v[i])){return v[i]}}return undefined};$scope.fnFactoryFilterByField=function(thisFieldName,filterByFieldName){return function(o){var thisField=$scope.form.fields[thisFieldName];var filterByField=$scope.form.fields[filterByFieldName];if(!filterByField.value){thisField.value=thisField.ddValue=thisField.tbValue="";thisField.selected=null;return false}var parentItem=filterByField.selected;if(parentItem==null){return false}if((thisField.selected&&thisField.selected.filter!="other"&&"/"+thisField.selected.filter!=parentItem.path&&thisField.selected.filter!=parentItem.value.toString().replace("/","\\/"))||(parentItem.filter&&filterByField.linkedTo&&$scope.form.fields[filterByField.linkedTo].selected.path!="/"+parentItem.filter&&$scope.form.fields[filterByField.linkedTo].selected.value.toString().replace("/","\\/")!=parentItem.filter)){var sameText=_find(thisField.options,function(o2){return(thisField.selected.text==o2.text)&&(o2.filter==parentItem.path||o2.filter==parentItem.value.toString().replace("/","\\/"))});if(sameText){thisField.selected=sameText}else{thisField.value=thisField.ddValue=thisField.tbValue="";thisField.selected=null;return false}}var parentFilter=parentItem.value;if(parentItem.filter){parentFilter=parentItem.filter+"/"+parentFilter.toString().replace("/","\\/")}return o.filter=="other"||o.filter==parentFilter||o.filter===parentItem.value.toString().replace("/","\\/")}};$scope.concatValues=function(ctl){if(!ctl.options){return}var vals=[];var texts=[];$.each(ctl.options,function(k,o){if(o.selected){vals.push(o.value);texts.push(o.text)}});ctl.value=vals.join(",");ctl.text=texts.join(", ")};$scope.countries={};$scope.wireRegion=function(regionField,countryField){if(!$scope.countries[countryField]){$scope.countries[countryField]={regionFields:[]}}$scope.countries[countryField].regionFields.push(regionField);$scope.loadRegions(countryField,function(){var val=$scope.form.fields[regionField].value;var regions=$scope.countries[countryField].regions;if(regions.length){for(var i=0;i<regions.length;i++){if(regions[i].value==val){return}}for(var i=0;i<regions.length;i++){if(regions[i].text==val){$scope.form.fields[regionField].ddValue=regions[i].value;return}}}})};$scope.loadRegions=function(countryField,fnDone){dnnsf.log("loadRegions",countryField,$scope.countries[countryField],$scope.form.fields[countryField]);$scope.$watch("form.fields."+countryField,function(){if(!$scope.countries[countryField]||!$scope.form.fields[countryField]){return}$scope.countries[countryField].loading=true;dataSources.get({DataSource:"Regions",ListId:$scope.form.fields[countryField].value,JsonLowercaseNames:true},function(data){$scope.countries[countryField].loading=false;$scope.countries[countryField].regions=data;if($scope.countries[countryField].regions.length){$.each($scope.countries[countryField].regionFields,function(i,o){if($scope.form.fields[o]){$scope.form.fields[o].tbValue=""}})}else{$.each($scope.countries[countryField].regionFields,function(i,o){if($scope.form.fields[o]){$scope.form.fields[o].ddValue=""}})}fnDone&&fnDone()})},true)}}function initForm(formRoot,options,localization){var $=dnnsfjQuery;formRoot=$(formRoot);formRoot[0].onFormSubmit=formRoot[0].onFormSubmit||[];if(!formRoot.length||formRoot[0].initialized){return}formRoot[0].initialized=true;dnnsf.init($,options);var app=angular.module("ActionForm"+formRoot.attr("id"),["ngAnimate","siyfion.sfTypeahead","bootstrap-tagsinput","ngSanitize","dnnsf"]);app.factory("dataSources",["$http","dnnsf",function($http,dnnsf){return{get:function(settings,fnReady){var p=$.extend({},settings,{Method:"GetData",tabId:options.tabId,mid:options.moduleId,alias:options.alias});$http({method:"GET",url:options.apiUrl+"?"+$.param(p),cache:true}).success(function(data,status){fnReady&&fnReady(data)})}}}]);app.provider("$cookieStore",[function(){var self=this;self.defaultOptions={};self.setDefaultOptions=function(options){self.defaultOptions=options};self.$get=function(){return{get:function(name){var jsonCookie=$.cookie(name);if(jsonCookie){return angular.fromJson(jsonCookie)}},put:function(name,value,options){options=$.extend({},self.defaultOptions,options);$.cookie(name,angular.toJson(value),options)},remove:function(name,options){options=$.extend({},self.defaultOptions,options);$.removeCookie(name,options)}}}}]);app.directive("inputMask",function(){return{restrict:"A",link:function(scope,el,attrs){if(navigator.userAgent.match(/Android/)){return}$(el).mask(attrs.inputMask);$(el).on("change",function(){scope.$eval(attrs.ngModel+"='"+el.val()+"'");scope.$apply()})}}});app.directive("onblur",function(){return{restrict:"A",scope:{onblur:"&"},link:function(scope,el,attrs){$(el).parents(".element-area:first").click(function(e){e.stopPropagation()});$(document).click(function(){scope.onblur();scope.$apply()})}}});app.directive("domWatch",function(){return{restrict:"A",link:function(scope,el,attrs){$(el).on(attrs.domWatch,function(){scope.$eval(attrs.ngModel+"='"+el.val()+"'");scope.$apply()})}}});app.directive("afBindvalue",["$compile","$timeout","$parse",function($compile,$timeout,$parse){return{restrict:"A",scope:false,require:"ngModel",link:function(scope,element,attrs,ngModel){var options=null;if(attrs.afBindfrom){options=scope.$eval(attrs.afBindfrom)}if(element.filter(":input").length==0){ngModel.$render=function(){if(!ngModel.$viewValue){return}element.html(ngModel.$viewValue||"")}}scope.$watch(attrs.afBindvalue,function(value){if(!scope.form.fields||!scope.form.fields[attrs.afField]){return}var field=scope.form.fields[attrs.afField];if(field.touched){return}if(attrs.afBindfrom){var options=scope.$eval(attrs.afBindfrom);if(!options){return}var optionsFound=$.grep(options,function(o){return o.value===value});if(optionsFound.length>0){ngModel.$setViewValue(optionsFound[0])}}else{ngModel.$setViewValue(value)}ngModel.$render()})}}}]);app.directive("afRichedit",["$compile","$timeout","$parse",function($compile,$timeout,$parse){return{require:"ngModel",link:function(scope,elm,attrs,ngModel){var fnInitRichEdit=function(){if(!$(elm).is(":visible")){$timeout(fnInitRichEdit,200);return}$(elm).wysiwyg({autoGrow:false,maxHeight:600,initialMinHeight:50,initialContent:"",brIE:false,replaceDivWithP:true,events:{save:function(){try{ngModel.$setViewValue(this.getContent())}catch(e){}}}});$('.wysiwyg [role="menuitem"]').each(function(){var l=localization["wysiwyg."+$(this).attr("class")];l&&$(this).attr("title",l)});ngModel.$render=function(){$(elm).wysiwyg("setContent",ngModel.$viewValue||"")}};$timeout(fnInitRichEdit,100)}}}]);!window.dnnsfAngularLock&&angular.bootstrap(formRoot,["ActionForm"+formRoot.attr("id")]);$.fn.popover&&formRoot.find("span.popupOnHover").popover({trigger:"hover"});formRoot.validate&&formRoot.validate({errorElement:"span",errorClass:"text-danger",highlight:function(element,errorClass){$(element).parents(".field-container:first").addClass("has-error")},unhighlight:function(element,errorClass){$(element).parents(".field-container:first").removeClass("has-error").find(".text-danger").hide()},errorPlacement:function(error,element){var errPlace=element.find(".err-placeholder");if(!errPlace.size()){errPlace=element.closest(".field-container").find(".err-placeholder")}if(errPlace.size()){errPlace.append(error)}else{if(element.is(":checkbox")||element.is(":radio")){element.parent().append(error)}else{error.insertAfter(element.filter(":visible"))}}},ignore:".ignore,:hidden,:disabled"});$.validator&&$.validator.addMethod("required-file",function(value,element){return $(element).hasClass("has-file")});$.validator&&$.validator.addMethod("required-fromclass",function(value,element){return $(element).hasClass("afvalid")});$.validator&&$.validator.addMethod("required-cblist",function(value,element){var group=$(element).attr("data-validation-group");var valid=false;$('[data-validation-group="'+group+'"]').each(function(){if(this.checked){valid=true}});return valid});formRoot.find("[data-password-confirm]").each(function(){$(this).rules("add",{equalTo:"#"+$(this).attr("data-password-confirm"),messages:{equalTo:localization["validation.passwordNoMatch"]}})});if(formRoot.closest("#Table1")){formRoot.closest("#Table1").addClass("container").parent().addClass("bstrap30")}function parseVar(strVar){if(!isNaN(parseInt(strVar))){return parseInt(strVar)}if(!isNaN(parseFloat(strVar))){return parseFloat(strVar)}if(strVar[0]=="["){return eval(strVar.replace("\n",""))}if(strVar=="false"){return false}if(strVar=="true"){return true}return strVar}for(var key in localization){if(key.indexOf("validation.")==0){var relKey=key.substr("validation.".length);if($.validator){$.validator.messages[relKey]=localization[key].indexOf("{0}")==-1?localization[key]:$.validator.format(localization[key])}}else{if(key.indexOf("jquery.datepicker.")==0&&$.datepicker){var relKey=key.substr("jquery.datepicker.".length);var s={};s[relKey]=parseVar(localization[key]);$.datepicker.setDefaults(s)}}}formRoot.find(".datepicker").change(function(){$(this).keyup()});setInterval(function(){$(".modal:visible").each(function(){var popup=$(this);popup.find(".modal-dialog:first").css("z-index",popup.find(".modal-backdrop:first").css("z-index")+1);popup.after(popup.find(".modal-dialog:first").siblings(".modal-backdrop"))})},100);dnnsfModernizr.load({test:dnnsfModernizr.mq("only all"),nope:options.appUrl+"/static/respond.js"});formRoot.find(".datepicker").each(function(){var opts={dateFormat:$(this).attr("data-dateformat"),changeMonth:$(this).attr("data-changemonth")=="true",changeYear:$(this).attr("data-changeyear")=="true",fixFocusIE:false,onSelect:function(dateText,inst){this.fixFocusIE=true;$(this).blur().change().focus()},onClose:function(dateText,inst){this.fixFocusIE=true;this.focus()},beforeShow:function(input,inst){var result=bowser.msie?!this.fixFocusIE:true;this.fixFocusIE=false;return result}};if($(this).attr("data-yearrange")){opts.yearRange=$(this).attr("data-yearrange")}if($(this).attr("data-opts")){opts=$.extend(opts,eval("("+$(this).attr("data-opts")+")"))}$(this).datepicker(opts);var theme=$(this).attr("data-theme");$("#ui-datepicker-div").each(function(){if($(this).parent("."+theme).size()==0){$(this).wrap('<div class="'+theme+'"></div>')}})});formRoot.find(".colorpickertext").each(function(){jQuery(this).ColorPicker({onSubmit:function(hsb,hex,rgb,el){jQuery(el).val("#"+hex);jQuery(el).ColorPickerHide()},onBeforeShow:function(){jQuery(this).ColorPickerSetColor(this.value)}})});$("[data-autocomplete]").each(function(){$(this).autocomplete({paramName:"query",serviceUrl:$(this).attr("data-autocomplete"),transformResult:function(response){return{suggestions:$.map($.parseJSON(response),function(dataItem){return{value:dataItem.Text,data:dataItem.Value}})}},onSelect:function(suggestion){angular.element(formRoot).scope().form.fields[$(this).attr("data-af-field")].value=suggestion.value;angular.element(formRoot).scope().form.fields[$(this).attr("data-af-field")].data=suggestion.data;angular.element(formRoot).scope().$apply()}})});formRoot.find(".file-upload").each(function(){this["aform"]=formRoot});yepnope({test:window.aform_incFileUplad,yep:[options.appUrl+"/templates/Form/bootstrap/fileupload/js/vendor/jquery.ui.widget.js",options.appUrl+"/templates/Form/bootstrap/fileupload/js/jquery.iframe-transport.js",options.appUrl+"/templates/Form/bootstrap/fileupload/js/jquery.fileupload.js"],complete:function(){if(!$().fileupload){return}$(".file-upload").each(function(){if(!this.aform){return}var $root=$(this).parents(".fileupload-root:first");var formRoot=this.aform;var _this=$(this);$root.find(".files").empty().append($("<p/>").text(angular.element(formRoot).scope().form.fields[_this.attr("data-af-field")].value));$(this).fileupload({url:$(this).attr("data-uploadurl"),dataType:"json",add:function(e,data){this.upldata=data;$.each(data.files,function(index,file){if(_this.attr("data-ext")){var ext=_this.attr("data-ext").toLowerCase().split(",");data.validext=false;var x;for(x in ext){if(file.name.split(".").pop().toLowerCase()==ext[x]){data.validext=true}}if(!data.validext){$root.find(".files").empty().append($("<p/>").text("File type not allowed"));$root.find(".files").show();$root.find(".files").css("color","red");return}}else{data.validext=true}var fext=file.name.split(".").pop().toLowerCase();if(false&&(fext=="jpg"||fext=="png")){var reader=new FileReader();reader.onload=function(e){$root.find(".files").empty().append($('<span class="glyphicon glyphicon-trash"></span><img width="180" />'));$root.find(".files img").attr("src",e.target.result);$root.find(".files span").click(function(){data.files[index]=undefined})};reader.readAsDataURL(file)}else{$root.find(".files").css("color","black");$root.find(".files").empty().append($("<p/>").text(file.name));$root.find(".files").show();$root.find(".file-upload").addClass("has-file").valid()}if(_this.attr("data-limit")!=null){data.validlimit=true;if(file.size>=parseFloat(_this.attr("data-limit"))*1048576){data.validlimit=false}if(!data.validlimit){$root.find(".files").empty().append($("<p/>").text("File size is to big"));$root.find(".files").show();$root.find(".files").css("color","red");return}}else{data.validext=true}})},done:function(e,data){$.each(data.result,function(index,file){$root.find(".files").empty().append($("<p/>").text(file.name));angular.element(formRoot).scope().form.fields[_this.attr("data-af-field")].value=file.relativeurl;angular.element(formRoot).scope().$apply()});$root.find(".progress").fadeOut("fast",function(){$root.find(".files").show()});formRoot[0].toUpload--;if(formRoot[0].toUpload==0){formRoot[0].submitData(formRoot[0].$btn)}},progressall:function(e,data){$root.find(".files").hide();$root.find(".progress").fadeIn("fast");var progress=parseInt(data.loaded/data.total*100,10);$root.find(".progress .progress-bar").css("width",progress+"%")}});var btn=$root.find(".fileinput-button");if(btn.find(".dnnInputFileWrapper").size()>0){btn.find("input").appendTo(btn);btn.find(".dnnInputFileWrapper").remove()}else{if(btn.find("input")[0]){btn.find("input")[0].wrapper="hack"}}})}});window.aform_incFileUplad=false;formRoot.find("input:text,input:password").keydown(function(evt){if(evt.keyCode==13){formRoot.find(".submit[data-default-button=on]:first").click();evt.preventDefault()}});try{formRoot.find(".button").button("reset")}catch(e){}formRoot.on("click",".form-button",function(){if(this.preventSubmit){return}formRoot.find(".server-error").html("").hide();var causesValidation=$(this).attr("data-validation")=="on";var fieldsToValidate=formRoot.find("input,textarea,select,.checkbox-list").not(":hidden,:disabled,.ignore");if(causesValidation&&fieldsToValidate.size()&&!fieldsToValidate.valid()){formRoot.find(".has-error:first").find("input,textarea,select").focus();return false}formRoot[0].toUpload=0;formRoot[0].$btn=$(this);formRoot.find(".file-upload").each(function(){$(this).fileupload("option","formData",getFormData(formRoot));var data=this.upldata;if(data&&data.validext&&data.validlimit){formRoot[0].toUpload++;data.process().done(function(){data.submit()})}});formRoot.find(".delay-submit").each(function(){formRoot[0].toUpload++});var $btn=$(this);try{$btn.hasClass("af-btn-loading")&&$btn.button("loading")}catch(e){}formRoot.find(".submit").not($btn).attr("disabled","disabled");formRoot.find(".submit-progress").css("visibility","visible").stop(true,true).fadeIn();if(formRoot[0].onFormSubmit){for(var i in formRoot[0].onFormSubmit){formRoot[0].onFormSubmit[i]($btn)}}if(!formRoot[0].toUpload){formRoot[0].submitData($btn)}return false});function getFormData(formRoot){var data={};formRoot.find(":input,[data-val],.value-node").each(function(){if(!$(this).attr("name")||!$(this).closest(".ng-hide")){return}var name=$(this).attr("name").replace(/dnn\d+/,"");if(!data[name]){data[name]=""}if($(this).attr("type")=="radio"){if(this.checked){data[name]=$(this).val()}}else{if($(this).attr("data-val")||$(this).attr("data-val")===""){data[name]=$(this).attr("data-val")}else{if($(this).hasClass("value-node")){data[name]=$(this).html()}else{data[name]=$(this).val()}}}});formRoot.find(".fileupload-root:visible").each(function(){data[$(this).find("input").attr("name").replace(/dnn\d+/,"")]=$(this).find(".relative-url").text()});formRoot.find(":checkbox:visible").each(function(){if(!$(this).attr("name")){return}var name=$(this).attr("name").replace(/dnn\d+/,"");if(name.indexOf("-")>0){name=name.substr(0,name.indexOf("-"));if(!data[name]){data[name]=""}if($(this).is(":checked")){data[name]+=(data[name].length?",":"")+$(this).val()}}else{data[name]=$(this).is(":checked")?"True":"False"}});formRoot.find(":radio:checked:visible").each(function(){data[$(this).attr("name").replace(/dnn\d+/,"")]=$(this).val()});formRoot.find(".itemwithqty input:visible").each(function(){data[$(this).attr("name").replace(/dnn\d+/,"")]=$("#"+$(this).attr("id")+"Qty").val()+" "+$(this).val()});formRoot.find("iframe").each(function(){if(this.contentWindow.getContent){data[$(this).attr("name").replace(/dnn\d+/,"")]=this.contentWindow.getContent()}});return data}formRoot[0].submitData=function($btn){if(formRoot[0].submitting){return}var data=getFormData(formRoot);formRoot[0].submitting=true;$.ajax({url:$btn.attr("data-submiturl")+"&referrer="+encodeURIComponent(document.referrer)+"&_url="+encodeURIComponent(document.URL),type:"post",data:data,dataType:"json"}).done(function(data){formRoot[0].submitting=false;parseFormResponse2(formRoot,$btn,data)})}}function parseFormResponse2(a,c,e){var d=dnnsfjQuery;function b(f,g){if(g){try{g.button("reset")}catch(h){}f.find(".submit").not(g).removeAttr("disabled")}f.find(".submit-progress").stop(true,true).fadeOut(function(){d(this).css("visibility","hidden")})}parseFormResponse(e,{executeJsFunction:function(f){window.parent[f](window.frameElement)},error:function(f){a.find(".server-error").html(e.error).show();b(a,c)},redirect:function(g){if(!e.popup&&!e.newTab){window.location=g;if(g.indexOf("#")==0){setTimeout(function(){b(a,c)},500)}return}if(e.newTab){window.open(g,"_blank");setTimeout(function(){b(a,c)},500);return}var f=d('<div class="af-modal modal fade"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">'+e.popupTitle+'</h4></div><div class="modal-body"><iframe width="100%" src="'+g+'" frameborder="0" scrolling="yes"></iframe></div></div><!-- /.modal-content --></div><!-- /.modal-dialog --></div><!-- /.modal -->').appendTo("body");console.log(f.modal);f.modal({backdrop:true});setInterval(function(){var h=d(".af-modal:visible").find("iframe");try{var j=d(h[0].contentDocument.body).height();if(j!=__prevHeight){__prevHeight=j;h.height(Math.max(200,j))}}catch(i){h.height(window.innerHeight-240)}},200);setTimeout(function(){b(a,c)},500)},message:function(g,f){if(!f||f=="success"){a.find(".c-form").slideUp();a.find(".submit-confirm2").hide();d("html, body").animate({scrollTop:a.offset().top-200},500)}a.find(".submit-confirm").html(g).show();b(a,c)},appendHtml:function(g,f,h){d(f).append(g);h&&b(a,c)},data:function(f){angular.element(a).scope().load(f);angular.element(a).scope().$apply();b(a,c)}})}function parseFormResponse(c,a){var b=dnnsfjQuery;a=b.extend({keepOnPage:function(d){window.location.reload(true)},redirect:function(d){window.location=d},appendHtml:function(e,d){b(d).append(e)},error:function(d){},message:function(e,d){},data:function(e,d){}},a);if(c.functionName){a.executeJsFunction&&a.executeJsFunction(c.functionName)}else{if(c.error){a.error&&a.error(c.error)}else{if(c.messageHtml){a.message&&a.message(c.messageHtml,c.type)}else{if(c.keepOnPage){a.keepOnPage&&a.keepOnPage(c.redirect)}else{if(c.redirect){a.redirect&&a.redirect(c.redirect)}else{if(c.appendHtml){a.appendHtml&&a.appendHtml(c.appendHtml,c.appendTo,c.reset)}else{if(c.data){a.data&&a.data(c.data)}}}}}}}};